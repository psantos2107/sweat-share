<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Log In</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link href="https://fonts.cdnfonts.com/css/kg-payphone" rel="stylesheet" />
    <link rel="stylesheet" href="/dynamicCSS/exercisePrograms/edit.css" />
  </head>
  <body>
    <%- include('./../partials/header.ejs', {logo: false, welcomeMsg: `Edit this
    Program!`, signup: false, login:false, myProfile:true, id}) %>
    <main>
      <article class="exercise-program-container">
        <section class="exercise-program-details">
          <h2>
            <strong><u><%=program.title%></u></strong>
          </h2>
          <h3>Created by: <%=program.createdBy.username%></h3>
          <p>Description: <%=program.description%></p>
          <p>Program Type: <%=program.programType%></p>
          <p>Difficulty: <%=program.difficulty%></p>
          <div class="exercise-container">
            <%program.exercises.forEach(exercise=>{ %>
            <article class="exercise-show">
              <section class="exercise-description">
                <h4>
                  <strong><u><%=exercise.name%></u></strong>
                </h4>
                <p>Description: <%=exercise.description%></p>
                <p>Sets: <%=exercise.sets%></p>
                <p>Repetitions: <%=exercise.repetitions%></p>
                <p>Rest Time: <%= exercise.restTime%></p>
                <p>Equipment: <%=exercise.equipmentNeeded%></p>
                <p>Muscles Worked: <%=exercise.muscleWorked%></p>
              </section>
              <section class="exercise-image">
                <img src="<%=`${exercise.imagePath || '/imgs/logo.jpg'}`%>" />
              </section>
            </article>
            <% })%>
          </div>
        </section>
        <section class="edit-form">
          <form
            action="/exercisePrograms/<%=program._id%>?_method=PUT"
            method="POST"
            id="exercise-program-creation"
          >
            <h2>
              <u
                ><strong
                  >Fill out the form below to create a new exercise
                  program!</strong
                ></u
              >
            </h2>
            <div class="mb-3">
              <label for="title-input" class="form-label"
                >What's the title of your program?</label
              >
              <input
                type="text"
                placeholder="Your title"
                class="form-control"
                id="title-input"
                name="title"
                aria-describedby="username input"
              />
            </div>
            <div class="mb-3">
              <label for="input-description" class="form-label"
                >Write a description about your exercise program!</label
              >
              <input
                type="text"
                name="description"
                class="form-control"
                placeholder="Your description here"
                id="input-password"
              />
            </div>
            <div class="mb-3">
              <label for="input-programType" class="form-label"
                >What type of program is it?</label
              >
              <select
                form="exercise-program-creation"
                name="programType"
                class="form-control"
                id="input-programType"
              >
                <option value="strength">Strength</option>
                <option value="cardio">Cardio</option>
                <option value="power">Power</option>
                <option value="endurance">Endurance</option>
                <option value="flexibility">Flexibility</option>
                <option value="balance">Balance</option>
                <option value="plyometrics">Plyometrics</option>
                <option value="functional">Functional</option>
                <option value="other">Other</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="input-difficulty" class="form-label"
                >How difficult is it?</label
              >
              <select
                form="exercise-program-creation"
                name="difficulty"
                class="form-control"
                id="input-difficulty"
              >
                <option value="beginner">Beginner</option>
                <option value="intermediate">Intermediate</option>
                <option value="advanced">Advanced</option>
              </select>
            </div>
            <fieldset class="mb-3 exercise-container">
              <h3>
                <strong>Input exercises for this program here!</strong>
              </h3>
              <article class="exercise-edit">
                <h3>Exercise</h3>
                <div class="mb-3">
                  <label for="exercise-name-0" class="form-label"
                    >Name of Exercise</label
                  >
                  <input
                    type="text"
                    id="exercise-name-0"
                    placeholder="Exercise Name"
                    class="form-control"
                    name="exercises[0][name]"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="exercise-description-0" class="form-label"
                    >Description of Exercise</label
                  >
                  <input
                    type="text"
                    id="exercise-description-0"
                    placeholder="Description"
                    class="form-control"
                    name="exercises[0][description]"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="exercise-sets-0" class="form-label"
                    >How many sets?</label
                  >
                  <input
                    type="text"
                    id="exercise-sets-0"
                    placeholder="Sets"
                    class="form-control"
                    name="exercises[0][sets]"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="exercise-repetitions-0" class="form-label"
                    >How many reps?</label
                  >
                  <input
                    type="text"
                    id="exercise-repetitions-0"
                    placeholder="Reps"
                    class="form-control"
                    name="exercises[0][repetitions]"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="exercise-restTime-0" class="form-label"
                    >How much rest time per rep?</label
                  >
                  <input
                    type="text"
                    id="exercise-restTime-0"
                    placeholder="Rest Time"
                    class="form-control"
                    name="exercises[0][restTime]"
                  />
                </div>
                <div class="mb-3">
                  <label for="exercise-imagePath-0" class="form-label"
                    >Drop a link to an image of how to do the exercise!</label
                  >
                  <input
                    type="text"
                    id="exercise-imagePath-0"
                    placeholder="Image Path"
                    class="form-control"
                    name="exercises[0][imagePath]"
                  />
                </div>
                <div class="mb-3">
                  <label for="exercise-equipmentNeeded-0" class="form-label"
                    >What equipment do you need?</label
                  >
                  <input
                    type="text"
                    id="exercise-equipmentNeeded-0"
                    placeholder="Equipment"
                    class="form-control"
                    name="exercises[0][equipmentNeeded]"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="exercise-muscleWorked-0" class="form-label"
                    >What muscles are worked?</label
                  >
                  <input
                    type="text"
                    id="exercise-muscleWorked-0"
                    placeholder="Active Muscles"
                    class="form-control"
                    name="exercises[0][muscleWorked]"
                    required
                  />
                </div>
                <button class="remove-exercise btn btn-secondary">
                  Remove exercise
                </button>
              </article>
              <article class="exercise-edit">
                <h3>Exercise</h3>
                <div class="mb-3">
                  <label for="exercise-name-1" class="form-label"
                    >Name of Exercise</label
                  >
                  <input
                    type="text"
                    id="exercise-name-1"
                    placeholder="Exercise Name"
                    class="form-control"
                    name="exercises[1][name]"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="exercise-description-1" class="form-label"
                    >Description of Exercise</label
                  >
                  <input
                    type="text"
                    id="exercise-description-1"
                    placeholder="Description"
                    class="form-control"
                    name="exercises[1][description]"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="exercise-sets-1" class="form-label"
                    >How many sets?</label
                  >
                  <input
                    type="text"
                    id="exercise-sets-1"
                    placeholder="Sets?"
                    class="form-control"
                    name="exercises[1][sets]"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="exercise-repetitions-1" class="form-label"
                    >How many reps?</label
                  >
                  <input
                    type="text"
                    id="exercise-repetitions-1"
                    placeholder="Reps?"
                    class="form-control"
                    name="exercises[1][repetitions]"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="exercise-restTime-1" class="form-label"
                    >How much rest time per rep?</label
                  >
                  <input
                    type="text"
                    id="exercise-restTime-1"
                    placeholder="Rest Time"
                    class="form-control"
                    name="exercises[1][restTime]"
                  />
                </div>
                <div class="mb-3">
                  <label for="exercise-imagePath-1" class="form-label"
                    >Drop a link to an image of how to do the exercise!</label
                  >
                  <input
                    type="text"
                    id="exercise-imagePath-1"
                    placeholder="Image Path"
                    class="form-control"
                    name="exercises[1][imagePath]"
                  />
                </div>
                <div class="mb-3">
                  <label for="exercise-equipmentNeeded-1" class="form-label"
                    >What equipment do you need?</label
                  >
                  <input
                    type="text"
                    id="exercise-equipmentNeeded-1"
                    placeholder="Equipment"
                    class="form-control"
                    name="exercises[1][equipmentNeeded]"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="exercise-muscleWorked-1" class="form-label"
                    >What muscles are worked?</label
                  >
                  <input
                    type="text"
                    id="exercise-muscleWorked-1"
                    placeholder="Active Muscles"
                    class="form-control"
                    name="exercises[1][muscleWorked]"
                    required
                  />
                </div>
                <button type="button" class="remove-exercise btn btn-secondary">
                  Remove exercise
                </button>
              </article>
              <button type="button" class="add-exercise btn btn-secondary">
                Add new exercise
              </button>
            </fieldset>
            <%if(errorMessage){ %>
            <p class="error-message"><%=errorMessage%></p>
            <%} %>
            <button type="submit" class="btn btn-primary submit-form">
              Submit Form
            </button>
          </form>
        </section>
      </article>
    </main>
    <%- include('./../partials/footer.ejs') %>
  </body>
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"
  ></script>
  <script>
    function logOut(id) {
      fetch(`/sessions`, { method: "DELETE" })
        .then((res) => {
          if (!response.ok) {
            throw new Error("Failed to sign out.");
          }
          window.location.href = "/";
        })
        .catch((err) => {
          console.log(err);
        });
    }

    let exerciseCounter = 2;
    const exerciseFormHTML = function (numExercise) {
      return `<article class="exercise-edit">
            <h3>Exercise</h3>
            <div class="mb-3">
              <label for="exercise-name-${numExercise}" class="form-label"
                >Name of Exercise</label
              >
              <input
                type="text"
                id="exercise-name-${numExercise}"
                placeholder="Exercise Name"
                class="form-control"
                name="exercises[${numExercise}][name]"
                required
              />
            </div>
            <div class="mb-3">
              <label for="exercise-description-${numExercise}" class="form-label"
                >Description of Exercise</label
              >
              <input
                type="text"
                id="exercise-description-${numExercise}"
                placeholder="Description"
                class="form-control"
                name="exercises[${numExercise}][description]"
                required
              />
            </div>
            <div class="mb-3">
              <label for="exercise-sets-${numExercise}" class="form-label"
                >How many sets?</label
              >
              <input
                type="text"
                id="exercise-sets-${numExercise}"
                placeholder="Sets?"
                class="form-control"
                name="exercises[${numExercise}][sets]"
                required
              />
            </div>
            <div class="mb-3">
              <label for="exercise-repetitions-${numExercise}" class="form-label"
                >How many reps?</label
              >
              <input
                type="text"
                id="exercise-repetitions-${numExercise}"
                placeholder="Reps?"
                class="form-control"
                name="exercises[${numExercise}][repetitions]"
                required
              />
            </div>
            <div class="mb-3">
              <label for="exercise-restTime-${numExercise}" class="form-label"
                >How much rest time per rep?</label
              >
              <input
                type="text"
                id="exercise-restTime-${numExercise}"
                placeholder="Rest Time"
                class="form-control"
                name="exercises[${numExercise}][restTime]"
              />
            </div>
            <div class="mb-3">
              <label for="exercise-imagePath-${numExercise}" class="form-label"
                >Drop a link to an image of how to do the exercise!</label
              >
              <input
                type="text"
                id="exercise-imagePath-${numExercise}"
                placeholder="Image Path"
                class="form-control"
                name="exercises[${numExercise}][imagePath]"
              />
            </div>
            <div class="mb-3">
              <label for="exercise-equipmentNeeded-${numExercise}" class="form-label"
                >What equipment do you need?</label
              >
              <input
                type="text"
                id="exercise-equipmentNeeded-${numExercise}"
                placeholder="Equipment"
                class="form-control"
                name="exercises[${numExercise}][equipmentNeeded]"
                required
              />
            </div>
            <div class="mb-3">
              <label for="exercise-muscleWorked-${numExercise}" class="form-label"
                >What muscles are worked?</label
              >
              <input
                type="text"
                id="exercise-muscleWorked-${numExercise}"
                placeholder="Active Muscles"
                class="form-control"
                name="exercises[${numExercise}][muscleWorked]"
                required
              />
            </div>
            <button class="remove-exercise btn btn-secondary">
              Remove exercise
            </button>
          </article>`;
    };

    const editForm = document.querySelector(".edit-form");
    editForm.addEventListener("click", function (e) {
      if (e.target.classList.contains("add-exercise")) {
        e.target.insertAdjacentHTML(
          "beforebegin",
          exerciseFormHTML(exerciseCounter)
        );
        exerciseCounter++;
      } else if (e.target.classList.contains("remove-exercise")) {
        e.target.parentElement.remove();
      }
    });
  </script>
</html>
